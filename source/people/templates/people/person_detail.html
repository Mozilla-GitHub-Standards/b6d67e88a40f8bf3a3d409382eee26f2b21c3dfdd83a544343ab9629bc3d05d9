{% extends "base.html" %}
{% set active_nav = "people" %}

{% block content %}
<div class="page-block">
    <h1 class="maintopic"><a href="{{ url('person_list') }}">People</a></h1>
</div>

<div class="page-block">
    <h2 id="person-name">{{ person.name() }}</h2>
    {% if person.description %}<p>{{ person.description|nl2br }}</p>{% endif %}

    <ul class="link-list">
        {% with organization_link_list = person.organizations.all() %}
        {% include "people/_organization_link_list_inline.html" %}{% endwith %}
        
        {% if person.email %}<li><i class="icon-envelope-alt"></i><a href="mailto:{{ person.email }}">{{ person.email }}</a></li>{% endif %}
        {% if person.twitter_username %}<li id="person-twitter"><i class="icon-twitter"></i><a href="http://twitter.com/{{ person.twitter_username }}">@{{ person.twitter_username }}</a></li>{% endif %}
        {% if person.github_username %}<li id="person-github"><i class="icon-github"></i><a href="http://github.com/{{ person.github_username }}">{{ person.github_username }}</a></li>{% endif %}
        {% for link in person.personlink_set.all() %}<li><i class="icon-bookmark"></i><a href="{{ link.url }}">{{ link.name }}</a></li>{% endfor %}
    </ul>
</div>

<div class="page-block">
    {% with code_link_list = person.code_set.all() %}
    {% include "code/_code_link_list.html" %}{% endwith %}

    {% with article_link_list = person.article_set.all(), override_list_title = 'Projects' %}
    {% include "articles/_article_link_list.html" %}{% endwith %}

    {% with article_link_list = person.article_authors.all(), override_list_title = 'Articles by %s' % person.first_name %}
    {% include "articles/_article_link_list.html" %}{% endwith %}
</div>
{% endblock content %}

{% block site_js_extra %}
{% if person.twitter_username or person.github_username %}
<script type="text/javascript">
$(document).ready(function(){
    {% if person.twitter_username %}
    var twitter_api_url='//api.twitter.com/1/users/show.json?screen_name={{ person.twitter_username }}&callback=?';
    $.getJSON(twitter_api_url, function(data) {
        var twitter_bio = data['description'];
        var twitter_avatar = data['profile_image_url'];
        var twitter_line = '<p class="twitter-bio"><img src="' + twitter_avatar + '">' + twitter_bio + '</p>';
        $('#person-name').after(twitter_line);
    });
    {% endif %}
    {% if person.github_username %}
    var github_api_url='https://api.github.com/users/{{ person.github_username }}';
    $.getJSON(github_api_url, function(data) {
        var github_repos = data['public_repos'];
        var repo_word = (github_repos == 1 ? 'repo' : 'repos')
        var github_gists = data['public_gists'];
        var gist_word = (github_gists == 1 ? 'gist' : 'gists')
        var github_line = '<span class="github-stats">(' + github_repos + ' ' + repo_word + ' / ' + github_gists + ' ' + gist_word + ')</span>';
        $('#person-github').append(github_line);
    });
    {% endif %}
});
</script>
{% endif %}
{% endblock %}