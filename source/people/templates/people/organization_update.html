{% extends "people/_base_people.html" %}

{% block content %}
<div class="authentication">
    {{ browserid_info() }}
    {% if not user.is_authenticated() %}
        {{ browserid_login(text='Log in to change your organization details') }}
    {% endif %}
</div>

{% if user.is_authenticated() and user.is_active and perms.people.change_organization %}
<div id="organization-manage">
    
    <h2>Edit settings: {{ organization }}</h2>
    
    {% if messages %}
        {% for message in messages %}
        <div class="alert">{{ message|safe }}</div>
        {% endfor %}
    {% endif %}

    <form method="post" action="" id="form-organization-update" onsubmit="submitUpdate();return false">
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
        
        <div class="column-half">
            <label for="id_address">Address:</label>
            {{ organization_form.address }}
        
            <div class="column-half">
                <label for="id_city">City:</label>
                {{ organization_form.city }}
            </div>
            <div class="column-half">
                <label for="id_state">State:</label>
                {{ organization_form.state }}
            </div>

            <label for="id_description">Description:</label>
            {{ organization_form.description }}
        </div>
        
        <div class="column-half">
            <label for="id_twitter_username">Twitter username:</label>
            <div class="input-prepend">
                <span class="add-on">@</span>
                {{ organization_form.twitter_username }}
            </div>

            <label for="id_github_username">Github username:</label>
            {{ organization_form.github_username }}
        
            <label for="id_homepage">Homepage:</label>
            {{ organization_form.homepage }}
        </div>
        
        <div class="page-block clear">
            <input class="btn btn-primary" id="organization-update-button" type="submit" value="Update details">
            {#}{{ browserid_logout(text='Log out', link_class='btn') }}{#}
        </div>
    </form>
    
</div>
{% endif %}
{% endblock content %}

{% block site_js_extra %}
{{ browserid_js() }}

<script type="text/javascript">
function alertSave(container, msg) {
    container.text(msg).delay(500).fadeOut('slow', function() {
        container.remove();
    });
}

function submitUpdate() {
    var statusMsg = $('<span class="save-alert">Saving</span>');
    var submitButton = $('#organization-update-button');
    submitButton.after(statusMsg);
    $.ajax({
        type: "POST",
        url: "{{ url('organization_update') }}",
        data: $('#form-organization-update').serialize(),
        dataType: "json",
        success: function(response) {
            alertSave(statusMsg, 'Saved!');
        },
        error: function(response) {
            alertSave(statusMsg, 'Error saving...');
        }
    });
}
</script>
{% endblock %}
